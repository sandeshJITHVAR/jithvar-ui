import React from 'react';
import ReactDOM from 'react-dom/client';
import { App } from './App';
import './newDemo.css';

// Override fetch for the demo to use mock API
const originalFetch = window.fetch;
window.fetch = async (input: RequestInfo | URL, init?: RequestInit) => {
  const url = typeof input === 'string' ? input : input instanceof URL ? input.href : input.url;
  
  // Use mock API for our demo table
  if (url.includes('mock-api/users')) {
    return mockAPI.createFetchFunction()(url);
  }
  
  // Use original fetch for other requests
  return originalFetch(input, init);
};

const App: React.FC = () => {
  const [dateRange, setDateRange] = useState<DateRange>({ startDate: null, endDate: null });
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);
  const [singleSelect, setSingleSelect] = useState<string | number | (string | number)[]>('');
  const [multiSelect, setMultiSelect] = useState<string | number | (string | number)[]>([]);
  const [apiSelect, setApiSelect] = useState<string | number | (string | number)[]>('');
  const [rangeValue, setRangeValue] = useState<[number, number]>([20, 80]);
  const [priceRange, setPriceRange] = useState<[number, number]>([100, 500]);

  // Static options for the select
  const staticOptions: Option[] = [
    { label: 'Apple', value: 'apple' },
    { label: 'Banana', value: 'banana' },
    { label: 'Orange', value: 'orange' },
    { label: 'Mango', value: 'mango' },
    { label: 'Grape', value: 'grape' },
    { label: 'Strawberry', value: 'strawberry' },
    { label: 'Pineapple', value: 'pineapple' },
    { label: 'Watermelon', value: 'watermelon' },
  ];

  return (
    <div className="demo-container">
      <header className="demo-header">
        <h1>üé® Jithvar UI Component Library</h1>
        <p>Modern React/Next.js UI components for your projects</p>
      </header>

      <main className="demo-main">
        {/* Date Range Picker Section */}
        <section className="demo-section">
          <h2>üìÖ Date Range Picker</h2>
          <p className="demo-description">
            Select date ranges with predefined options or custom selection. Supports multiple
            preset ranges including Yesterday, Last 7/15/30 Days, Current/Last Month, and more.
          </p>

          <div className="demo-component">
            <DateRangePicker value={dateRange} onChange={setDateRange} />
          </div>

          <div className="demo-output">
            <h3>Selected Range:</h3>
            <pre>
              {JSON.stringify(
                {
                  startDate: dateRange.startDate?.toLocaleDateString(),
                  endDate: dateRange.endDate?.toLocaleDateString(),
                },
                null,
                2
              )}
            </pre>
          </div>
        </section>

        {/* Date Picker Section */}
        <section className="demo-section">
          <h2>üìÜ Date Picker</h2>
          <p className="demo-description">
            Single date selection with optional min/max date constraints.
          </p>

          <div className="demo-component">
            <DatePicker value={selectedDate} onChange={setSelectedDate} placeholder="Select a date" />
          </div>

          <div className="demo-output">
            <h3>Selected Date:</h3>
            <pre>{JSON.stringify({ date: selectedDate?.toLocaleDateString() }, null, 2)}</pre>
          </div>
        </section>

        {/* Single Select Section */}
        <section className="demo-section">
          <h2>üîç Searchable Select (Single)</h2>
          <p className="demo-description">
            Single selection dropdown with search functionality. Perfect for selecting one option
            from a list.
          </p>

          <div className="demo-component">
            <SearchableSelect
              value={singleSelect}
              onChange={setSingleSelect}
              options={staticOptions}
              placeholder="Search fruits..."
              multiple={false}
            />
          </div>

          <div className="demo-output">
            <h3>Selected Value:</h3>
            <pre>{JSON.stringify({ value: singleSelect }, null, 2)}</pre>
          </div>
        </section>

        {/* Multiple Select Section */}
        <section className="demo-section">
          <h2>üîç Searchable Select (Multiple)</h2>
          <p className="demo-description">
            Multiple selection dropdown with search functionality. Select multiple options with
            tag-based display.
          </p>

          <div className="demo-component">
            <SearchableSelect
              value={multiSelect}
              onChange={setMultiSelect}
              options={staticOptions}
              placeholder="Search fruits..."
              multiple={true}
            />
          </div>

          <div className="demo-output">
            <h3>Selected Values:</h3>
            <pre>{JSON.stringify({ values: multiSelect }, null, 2)}</pre>
          </div>
        </section>

        {/* API Select Section */}
        <section className="demo-section">
          <h2>üåê Searchable Select (API - Example)</h2>
          <p className="demo-description">
            Server-side search with API integration. Requires minimum 3 characters to trigger
            search. Example uses JSONPlaceholder API.
          </p>

          <div className="demo-component">
            <SearchableSelect
              value={apiSelect}
              onChange={setApiSelect}
              apiUrl="https://jsonplaceholder.typicode.com/users"
              apiSearchParam="q"
              minSearchLength={3}
              placeholder="Type at least 3 characters..."
              labelKey="name"
              valueKey="id"
              renderOption={(option) => (
                <div>
                  <div style={{ fontWeight: 600 }}>{option.name}</div>
                  <div style={{ fontSize: '0.75rem', color: '#6b7280' }}>{option.email}</div>
                </div>
              )}
            />
          </div>

          <div className="demo-output">
            <h3>Selected Value:</h3>
            <pre>{JSON.stringify({ value: apiSelect }, null, 2)}</pre>
            <p className="demo-note">
              Note: The API example uses JSONPlaceholder which doesn't support actual filtering.
              In production, use your own API endpoint.
            </p>
          </div>
        </section>

        {/* Range Slider Section */}
        <section className="demo-section">
          <h2>üéöÔ∏è Range Slider</h2>
          <p className="demo-description">
            Dual-handle range slider for selecting min and max values. Perfect for price ranges,
            age filters, and more.
          </p>

          <div className="demo-component">
            <div style={{ width: '100%', maxWidth: '500px' }}>
              <h3 style={{ fontSize: '1rem', marginBottom: '1rem' }}>Basic Range (0-100)</h3>
              <RangeSlider
                min={0}
                max={100}
                value={rangeValue}
                onChange={setRangeValue}
                showLabels={true}
                showTooltip={true}
              />
            </div>
          </div>

          <div className="demo-component" style={{ marginTop: '2rem' }}>
            <div style={{ width: '100%', maxWidth: '500px' }}>
              <h3 style={{ fontSize: '1rem', marginBottom: '1rem' }}>Price Range ($0-$1000)</h3>
              <RangeSlider
                min={0}
                max={1000}
                step={10}
                value={priceRange}
                onChange={setPriceRange}
                showLabels={true}
                showTooltip={true}
                formatLabel={(val) => `$${val}`}
              />
            </div>
          </div>

          <div className="demo-output">
            <h3>Selected Ranges:</h3>
            <pre>
              {JSON.stringify(
                {
                  basicRange: rangeValue,
                  priceRange: priceRange.map((v) => `$${v}`),
                },
                null,
                2
              )}
            </pre>
          </div>
        </section>

        {/* JTable Section */}
        <section className="demo-section">
          <h2>üìä JTable - Advanced Data Table</h2>
          <p className="demo-description">
            Advanced data table with server-side pagination, sorting, universal search, column
            filters (with popup filters), row selection, customizable actions, and column visibility
            controls. All state is synced with URL parameters for shareable filtered results.
          </p>

          <JTable
            columns={[
              { 
                key: 'id', 
                label: 'ID', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'number', 
                width: '80px',
                visible: true 
              },
              { 
                key: 'name', 
                label: 'Name', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'text',
                visible: true 
              },
              { 
                key: 'email', 
                label: 'Email', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'text',
                visible: true 
              },
              { 
                key: 'department', 
                label: 'Department', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'text',
                visible: true 
              },
              { 
                key: 'age', 
                label: 'Age', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'number',
                width: '100px',
                visible: true 
              },
              { 
                key: 'salary', 
                label: 'Salary', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'number',
                width: '120px',
                visible: true,
                render: (value) => `$${value.toLocaleString()}`
              },
              { 
                key: 'joinDate', 
                label: 'Join Date', 
                sortable: true, 
                filterable: true, 
                searchable: true, 
                type: 'date',
                width: '150px',
                visible: true,
                render: (value) => new Date(value).toLocaleDateString()
              },
              { 
                key: 'phone', 
                label: 'Phone', 
                sortable: false, 
                filterable: true, 
                searchable: true, 
                type: 'text',
                visible: false  // Hidden by default
              },
              {
                key: 'status',
                label: 'Status',
                sortable: true,
                filterable: true,
                searchable: true,
                type: 'text',
                width: '100px',
                visible: true,
                render: (value) => (
                  <span
                    style={{
                      padding: '0.25rem 0.5rem',
                      borderRadius: '0.25rem',
                      fontSize: '0.75rem',
                      fontWeight: 600,
                      background: value === 'active' ? '#dcfce7' : '#fee2e2',
                      color: value === 'active' ? '#166534' : '#991b1b',
                    }}
                  >
                    {value}
                  </span>
                ),
              },
            ] as JTableColumn[]}
            actions={[
              {
                label: 'View',
                icon: 'üëÅÔ∏è',
                onClick: (row) => alert(`Viewing: ${row.name}\nEmail: ${row.email}\nDepartment: ${row.department}`),
                variant: 'primary',
                tooltip: 'View details'
              },
              {
                label: 'Edit',
                icon: '‚úèÔ∏è',
                onClick: (row) => alert(`Editing: ${row.name}`),
                variant: 'info',
                tooltip: 'Edit record',
                showOnHover: true  // Only show on row hover
              },
              {
                icon: '‚ãÆ',
                variant: 'ghost',
                tooltip: 'More actions',
                onClick: () => {}, // Parent onClick required but not used
                dropdown: [
                  {
                    label: 'Duplicate',
                    icon: 'üìã',
                    onClick: (row) => alert(`Duplicating: ${row.name}`),
                    variant: 'secondary'
                  },
                  {
                    label: 'Archive',
                    icon: 'üì¶',
                    onClick: (row) => alert(`Archiving: ${row.name}`),
                    variant: 'warning'
                  },
                  {
                    label: 'Delete',
                    icon: 'üóëÔ∏è',
                    onClick: (row) => {
                      if (confirm(`Delete ${row.name}?`)) {
                        alert('Deleted successfully!');
                      }
                    },
                    variant: 'danger',
                    visible: (row) => row.id !== 1  // Hide delete for first user
                  },
                ]
              },
            ] as JTableAction[]}
            apiUrl="https://mock-api/users"
            enableUniversalSearch={true}
            universalSearchPlaceholder="Search users..."
            enableColumnSearch={true}
            searchMode="like"
            enableSelection={true}
            selectionMode="multiple"
            enablePagination={true}
            enableColumnToggle={true}
            pageSizeOptions={[5, 10, 20, 50]}
            defaultPageSize={5}
            actionColumnLabel="Actions"
            actionColumnPosition="right"
            actionColumnWidth="200px"
            striped={true}
            hover={true}
            bordered={false}
            compact={false}
            stickyHeader={false}
            onSelectionChange={(rows) => console.log('Selected rows:', rows)}
            onRowClick={(row) => console.log('Row clicked:', row)}
          />

          <div className="demo-note" style={{ marginTop: '1rem' }}>
            <strong>‚ú® JTable Features:</strong>
            <ul style={{ marginTop: '0.5rem', paddingLeft: '1.5rem' }}>
              <li>üîç <strong>Smart Filters</strong> - Click filter icon to open filter dropdown (date range for dates, range slider for numbers, text search for strings)</li>
              <li>‚öôÔ∏è <strong>Column Visibility</strong> - Toggle column visibility using the "Columns" button</li>
              <li>üéØ <strong>Custom Actions</strong> - Add action buttons with variants (primary, secondary, danger, success, warning, info, ghost)</li>
              <li>üé® <strong>Hover Actions</strong> - Show/hide action buttons on row hover with <code>showOnHover</code> prop</li>
              <li>üìã <strong>Dropdown Menus</strong> - Group multiple actions in dropdown menus for cleaner UI</li>
              <li>‚ú® <strong>Icons Support</strong> - Add icons (emoji or React components) to action buttons</li>
              <li>‚úÖ <strong>Row Selection</strong> - Single or multiple selection modes</li>
              <li>üîó <strong>URL State</strong> - All filters, sorting, and pagination are in URL for easy sharing</li>
              <li>üé® <strong>Customizable</strong> - Striped rows, hover effects, borders, compact mode, sticky headers</li>
              <li>üîé <strong>Search Modes</strong> - Supports 'like', 'exact', 'startsWith', 'endsWith' search modes</li>
            </ul>
            
            <p style={{ marginTop: '1rem' }}><strong>API Integration:</strong></p>
            <p>Your backend should handle these query parameters:</p>
            <ul style={{ marginTop: '0.5rem', paddingLeft: '1.5rem' }}>
              <li><code>page</code> - Current page number</li>
              <li><code>pageSize</code> - Records per page</li>
              <li><code>sortColumn</code> - Column to sort by</li>
              <li><code>sortDirection</code> - asc/desc</li>
              <li><code>search</code> - Universal search term</li>
              <li><code>searchMode</code> - like/exact/startsWith/endsWith</li>
              <li><code>[columnKey]</code> - Column text filter</li>
              <li><code>[columnKey]_start, [columnKey]_end</code> - Date range</li>
              <li><code>[columnKey]_min, [columnKey]_max</code> - Number range</li>
            </ul>
          </div>
        </section>

        {/* Features Section */}
        <section className="demo-section demo-features">
          <h2>‚ú® Features</h2>
          <div className="feature-grid">
            <div className="feature-card">
              <h3>üé® Customizable Styling</h3>
              <p>Uses CSS classes that can be customized to match your project's design system</p>
            </div>
            <div className="feature-card">
              <h3>üì± Responsive</h3>
              <p>Works perfectly on desktop and mobile devices</p>
            </div>
            <div className="feature-card">
              <h3>‚ö° TypeScript Support</h3>
              <p>Full TypeScript definitions included for better development experience</p>
            </div>
            <div className="feature-card">
              <h3>üîå Easy Integration</h3>
              <p>Simple props interface, works with React and Next.js</p>
            </div>
          </div>
        </section>

        {/* Installation Section */}
        <section className="demo-section">
          <h2>üì¶ Installation</h2>
          <div className="code-block">
            <code>npm install jithvar-ui</code>
          </div>
          <p>or</p>
          <div className="code-block">
            <code>yarn add jithvar-ui</code>
          </div>
        </section>

        {/* Usage Section */}
        <section className="demo-section">
          <h2>üíª Usage</h2>
          <div className="code-block">
            <pre>{`import { DateRangePicker, SearchableSelect } from 'jithvar-ui';

function MyComponent() {
  const [dateRange, setDateRange] = useState({ startDate: null, endDate: null });
  const [selected, setSelected] = useState('');

  return (
    <>
      <DateRangePicker value={dateRange} onChange={setDateRange} />
      <SearchableSelect
        value={selected}
        onChange={setSelected}
        options={[
          { label: 'Option 1', value: '1' },
          { label: 'Option 2', value: '2' },
        ]}
      />
    </>
  );
}`}</pre>
          </div>
        </section>
      </main>

      <footer className="demo-footer">
        <p>Built with ‚ù§Ô∏è by the Jithvar UI Team</p>
      </footer>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
